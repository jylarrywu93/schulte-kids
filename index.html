<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å…’ç«¥ç‰ˆèˆ’çˆ¾ç‰¹æ–¹æ ¼å°éŠæˆ²</title>
  <!-- è®“ iPhone é¡¯ç¤ºæ­£å¸¸ç¸®æ”¾ / Make it look good on iPhone -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent; /* iPhone é»æ“Šä¸è¦è—æ¡† / Remove tap highlight */
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at top, #fee2e2 0, #bfdbfe 40%, #e0f2fe 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        "Noto Sans TC", sans-serif;
    }

    .container {
      background: #ffffffee;
      border-radius: 24px;
      padding: 18px 18px 20px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
      max-width: 460px;
      width: 100%;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 22px;
      text-align: center;
    }

    .subtitle {
      margin: 0 0 10px;
      font-size: 12px;
      text-align: center;
      color: #666;
      line-height: 1.4;
    }

    .subtitle span.en {
      font-size: 11px;
      color: #888;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
    }

    .controls label {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    select {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #cbd5f5;
      font-size: 12px;
      background: #eff6ff;
    }

    button#startBtn {
      padding: 6px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 700;
      background: linear-gradient(135deg, #fb7185, #f97316);
      color: #fff;
      box-shadow: 0 4px 10px rgba(248, 113, 113, 0.4);
      transition: transform 0.1s ease, box-shadow 0.1s ease,
        filter 0.15s ease;
      white-space: nowrap;
    }

    button#startBtn:active {
      transform: translateY(1px) scale(0.97);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.18);
      filter: brightness(0.95);
    }

    button#startBtn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      box-shadow: none;
    }

    .status-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 2px;
      font-size: 11px;
    }

    .status-line {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .status-label {
      color: #6b7280;
    }

    .status-value {
      font-weight: 700;
      font-size: 14px;
      color: #111827;
    }

    .target-box {
      margin: 4px 0 10px;
      padding: 8px 10px;
      border-radius: 16px;
      background: linear-gradient(135deg, #bfdbfe, #e0f2fe);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .target-text {
      font-size: 13px;
      color: #1f2933;
    }

    .target-text small {
      font-size: 11px;
      color: #4b5563;
      display: block;
    }

    .target-number {
      font-size: 32px;
      font-weight: 800;
      color: #1d4ed8;
      min-width: 48px;
      text-align: center;
    }

    .grid-wrapper {
      width: 100%;
      aspect-ratio: 1 / 1;
    }

    .grid {
      display: grid;
      width: 100%;
      height: 100%;
      gap: 6px;
    }

    .cell {
      border-radius: 14px;
      border: 2px solid #e5e7eb;
      background: #fef9c3;
      font-size: 20px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.12s ease, transform 0.07s ease,
        box-shadow 0.12s ease, border-color 0.12s ease, color 0.12s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
    }

    .cell:active {
      transform: scale(0.95);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
    }

    .cell.hit {
      background: #bbf7d0;
      color: #14532d;
      border-color: #16a34a;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.3);
    }

    .cell.wrong {
      background: #fecaca;
      border-color: #ef4444;
      animation: shake 0.18s linear;
    }

    .message {
      margin-top: 8px;
      font-size: 12px;
      text-align: center;
      color: #374151;
      min-height: 18px;
    }

    .message strong {
      color: #b91c1c;
    }

    @keyframes shake {
      0% {
        transform: translateX(0);
      }
      25% {
        transform: translateX(-2px);
      }
      50% {
        transform: translateX(2px);
      }
      75% {
        transform: translateX(-1px);
      }
      100% {
        transform: translateX(0);
      }
    }

    @media (max-width: 480px) {
      .container {
        margin: 10px;
        padding: 14px 12px 16px;
        border-radius: 18px;
      }

      h1 {
        font-size: 18px;
      }

      .cell {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>å…’ç«¥ç‰ˆèˆ’çˆ¾ç‰¹æ–¹æ ¼å°éŠæˆ²</h1>
    <p class="subtitle">
      ç·´ç¿’å°ˆå¿ƒã€çœ¼ç›å¿«å¿«æ‰¾æ•¸å­—çš„éŠæˆ²ã€‚<br />
      <span class="en">A simple focus & number-finding game for kids / çµ¦å°æœ‹å‹çš„å°ˆæ³¨åŠ›èˆ‡æ‰¾æ•¸å­—éŠæˆ²</span>
    </p>

    <div class="top-row">
      <div class="controls">
        <label>
          æ–¹æ ¼å¤§å°ï¼ˆGrid Size / æ–¹æ ¼å¤§å°ï¼‰ï¼š
          <select id="gridSize">
            <option value="3">3 Ã— 3ï¼ˆå…¥é–€ï¼‰</option>
            <option value="4">4 Ã— 4</option>
            <option value="5" selected>5 Ã— 5ï¼ˆæŒ‘æˆ°ï¼‰</option>
          </select>
        </label>
      </div>
      <div class="status-right">
        <div class="status-line">
          <span class="status-label">ç”¨æ™‚ Time / èŠ±è²»æ™‚é–“ï¼š</span>
          <span class="status-value" id="timer">0.00s</span>
        </div>
        <div class="status-line">
          <span class="status-label">æœ€å¥½ Best / æœ€ä½³ç´€éŒ„ï¼š</span>
          <span class="status-value" id="bestTime">â€”</span>
        </div>
      </div>
    </div>

    <div class="target-box">
      <div class="target-text">
        ğŸ¯ è«‹æ‰¾é€™å€‹æ•¸å­—ï¼ˆFind this number / è«‹æ‰¾ä¸‹é¢çš„æ•¸å­—ï¼‰ï¼š<br />
        <small>å¾ 1 é–‹å§‹ï¼Œä¾ç…§é †åº 1 â†’ 2 â†’ 3â€¦ é»ä¸‹å»ã€‚</small>
      </div>
      <div class="target-number" id="nextNumber">â€”</div>
    </div>

    <button id="startBtn" style="width: 100%; margin-bottom: 10px;">
      ğŸš€ é–‹å§‹éŠæˆ² Start / é–‹å§‹
    </button>

    <div class="grid-wrapper">
      <div class="grid" id="grid"></div>
    </div>

    <div class="message" id="message">
      æŒ‰ã€Œé–‹å§‹éŠæˆ²ã€å¾Œï¼Œå¾ <strong>1</strong> é–‹å§‹æ‰¾æ•¸å­—ã€‚<br />
      Click numbers in order / å¾ 1 é–‹å§‹ä¾åºé»ã€‚
    </div>
  </div>

  <script>
    const gridSizeSelect = document.getElementById("gridSize");
    const startBtn = document.getElementById("startBtn");
    const gridEl = document.getElementById("grid");
    const timerEl = document.getElementById("timer");
    const bestTimeEl = document.getElementById("bestTime");
    const nextNumberEl = document.getElementById("nextNumber");
    const messageEl = document.getElementById("message");

    let currentNumber = 1;
    let maxNumber = 25;
    let startTime = null;
    let timerInterval = null;
    let isRunning = false;

    // å„æ–¹æ ¼å¤§å°æœ€ä½³ç´€éŒ„ï¼ˆç§’ï¼‰
    // Best time per grid size / å„æ–¹æ ¼å¤§å°æœ€ä½³ç´€éŒ„
    const bestTimes = {};

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        const temp = array[i];
        array[i] = array[j];
        array[j] = temp;
      }
      return array;
    }

    function generateGrid(size) {
      gridEl.innerHTML = "";
      // é€™è£¡æ˜¯å‰ä¸€ç‰ˆçš„ bugï¼šå¯«æˆ repeat(${size, 1fr})ï¼Œé€™æ¨£ JS ç›´æ¥éŒ¯èª¤ã€‚
      // This line was the bug before; now it's fixed:
      gridEl.style.gridTemplateColumns = "repeat(" + size + ", 1fr)";

      const total = size * size;
      const numbers = shuffle(
        Array.from({ length: total }, function (_, i) {
          return i + 1;
        })
      );

      numbers.forEach(function (num) {
        const btn = document.createElement("button");
        btn.className = "cell";
        btn.textContent = num;
        btn.setAttribute("data-number", String(num));
        btn.addEventListener("click", onCellClick);
        gridEl.appendChild(btn);
      });
    }

    function startGame() {
      const size = parseInt(gridSizeSelect.value, 10);
      maxNumber = size * size;
      currentNumber = 1;
      isRunning = true;
      startBtn.disabled = true;

      messageEl.innerHTML =
        "éŠæˆ²é–‹å§‹å›‰ï¼å¾ <strong>1</strong> é–‹å§‹ä¾åºé»æ•¸å­—ã€‚<br/>Game start! Click numbers in order / å¾ 1 é–‹å§‹ã€‚";
      nextNumberEl.textContent = String(currentNumber);
      timerEl.textContent = "0.00s";

      generateGrid(size);

      if (timerInterval) {
        clearInterval(timerInterval);
      }
      startTime = Date.now();
      timerInterval = setInterval(updateTimer, 60);

      const key = getBestKey();
      if (bestTimes[key] != null) {
        bestTimeEl.textContent = bestTimes[key].toFixed(2) + "s";
      } else {
        bestTimeEl.textContent = "â€”";
      }
    }

    function updateTimer() {
      if (!isRunning || !startTime) return;
      const elapsed = (Date.now() - startTime) / 1000;
      timerEl.textContent = elapsed.toFixed(2) + "s";
    }

    function finishGame() {
      isRunning = false;
      startBtn.disabled = false;
      clearInterval(timerInterval);
      timerInterval = null;

      const finalTime = (Date.now() - startTime) / 1000;
      timerEl.textContent = finalTime.toFixed(2) + "s";

      const key = getBestKey();
      if (bestTimes[key] == null || finalTime < bestTimes[key]) {
        bestTimes[key] = finalTime;
        bestTimeEl.textContent = finalTime.toFixed(2) + "s";
        messageEl.innerHTML =
          "å¤ªæ£’äº†ï¼ğŸ¥³ ä½ æ‰“ç ´è‡ªå·±çš„æœ€ä½³ç´€éŒ„ï¼<br/>Great! New best time / æ–°çš„æœ€å¥½æˆç¸¾ï¼";
      } else {
        messageEl.innerHTML =
          "å®Œæˆï¼ğŸ‘ å¯ä»¥å†ç©ä¸€æ¬¡ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ›´å¿«ï½<br/>Completed! Try again / å†æŒ‘æˆ°çœ‹çœ‹ã€‚";
      }

      nextNumberEl.textContent = "â€”";
    }

    function onCellClick(e) {
      if (!isRunning) return;

      const target = e.currentTarget;
      const num = Number(target.getAttribute("data-number"));

      if (num === currentNumber) {
        target.classList.add("hit");
        target.disabled = true;
        currentNumber += 1;
        nextNumberEl.textContent =
          currentNumber <= maxNumber ? String(currentNumber) : "â€”";

        if (currentNumber > maxNumber) {
          finishGame();
        }
      } else {
        // é»éŒ¯æ•¸å­—
        target.classList.add("wrong");
        messageEl.innerHTML =
          "é€™å€‹ä¸æ˜¯ç¾åœ¨è¦æ‰¾çš„æ•¸å­—å–”ï½è«‹æ‰¾ <strong>" +
          (currentNumber <= maxNumber ? currentNumber : "å®Œæˆ") +
          "</strong>ã€‚<br/>Not this one. Find number " +
          (currentNumber <= maxNumber ? currentNumber : "done") +
          " / è«‹æ‰¾æ­£ç¢ºæ•¸å­—ã€‚";
        setTimeout(function () {
          target.classList.remove("wrong");
        }, 180);
      }
    }

    function getBestKey() {
      const size = parseInt(gridSizeSelect.value, 10);
      return size + "x" + size;
    }

    // åˆå§‹åŒ–é¡¯ç¤º 5Ã—5
    // Initial render / åˆå§‹é¡¯ç¤º
    generateGrid(5);
    nextNumberEl.textContent = "â€”";

    startBtn.addEventListener("click", startGame);
  </script>
</body>
</html>
