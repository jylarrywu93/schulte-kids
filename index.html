<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å¤šä¸»é¡Œå…’ç«¥ç‰ˆèˆ’çˆ¾ç‰¹æ–¹æ ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at top, #fee2e2 0, #bfdbfe 40%, #e0f2fe 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        "Noto Sans TC", sans-serif;
    }

    .container {
      background: #ffffffee;
      border-radius: 24px;
      padding: 18px 18px 20px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
      max-width: 480px;
      width: 100%;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 22px;
      text-align: center;
    }

    .subtitle {
      margin: 0 0 10px;
      font-size: 12px;
      text-align: center;
      color: #666;
      line-height: 1.4;
    }

    .subtitle span.en {
      font-size: 11px;
      color: #888;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 13px;
    }

    .controls-line {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .controls label {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    select {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #cbd5f5;
      font-size: 12px;
      background: #eff6ff;
    }

    button#startBtn {
      padding: 6px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 700;
      background: linear-gradient(135deg, #fb7185, #f97316);
      color: #fff;
      box-shadow: 0 4px 10px rgba(248, 113, 113, 0.4);
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.15s ease;
      white-space: nowrap;
    }

    button#startBtn:active {
      transform: translateY(1px) scale(0.97);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.18);
      filter: brightness(0.95);
    }

    button#startBtn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      box-shadow: none;
    }

    .status-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 2px;
      font-size: 11px;
    }

    .status-line {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .status-label {
      color: #6b7280;
    }

    .status-value {
      font-weight: 700;
      font-size: 14px;
      color: #111827;
    }

    .target-box {
      margin: 4px 0 10px;
      padding: 8px 10px;
      border-radius: 16px;
      background: linear-gradient(135deg, #bfdbfe, #e0f2fe);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .target-text {
      font-size: 13px;
      color: #1f2933;
    }

    .target-text small {
      font-size: 11px;
      color: #4b5563;
      display: block;
    }

    .target-main {
      text-align: right;
    }

    .target-number {
      font-size: 32px;
      font-weight: 800;
      color: #1d4ed8;
      min-width: 60px;
      text-align: center;
      line-height: 1.1;
    }

    .target-sub {
      font-size: 11px;
      color: #374151;
    }

    .grid-wrapper {
      width: 100%;
      aspect-ratio: 1 / 1;
    }

    .grid {
      display: grid;
      width: 100%;
      height: 100%;
      gap: 6px;
    }

    .cell {
      border-radius: 14px;
      border: 2px solid #e5e7eb;
      background: #fef9c3;
      font-size: 20px;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.12s ease, transform 0.07s ease,
        box-shadow 0.12s ease, border-color 0.12s ease, color 0.12s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2px;
      text-align: center;
    }

    .cell-label {
      display: block;
      font-size: 18px;
      line-height: 1.1;
    }

    .cell-sub {
      display: block;
      font-size: 10px;
      line-height: 1.1;
      margin-top: 2px;
    }

    .cell:active {
      transform: scale(0.95);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
    }

    .cell.hit {
      background: #bbf7d0;
      color: #14532d;
      border-color: #16a34a;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.3);
    }

    .cell.wrong {
      background: #fecaca;
      border-color: #ef4444;
      animation: shake 0.18s linear;
    }

    .message {
      margin-top: 8px;
      font-size: 12px;
      text-align: center;
      color: #374151;
      min-height: 18px;
    }

    .message strong {
      color: #b91c1c;
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-2px); }
      50% { transform: translateX(2px); }
      75% { transform: translateX(-1px); }
      100% { transform: translateX(0); }
    }

    @media (max-width: 480px) {
      .container {
        margin: 10px;
        padding: 14px 12px 16px;
        border-radius: 18px;
      }
      h1 {
        font-size: 18px;
      }
      .cell {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>å¤šä¸»é¡Œå…’ç«¥ç‰ˆèˆ’çˆ¾ç‰¹æ–¹æ ¼</h1>
    <p class="subtitle">
      çµ¦ 3ï½6 æ­²å°æœ‹å‹çš„å°ˆå¿ƒèˆ‡æ‰¾æ±è¥¿éŠæˆ²ã€‚<br />
      <span class="en">Multi-theme Schulte table game for kids / çµ¦å°æœ‹å‹çš„å¤šä¸»é¡Œèˆ’çˆ¾ç‰¹æ–¹æ ¼</span>
    </p>

    <div class="top-row">
      <div class="controls">
        <div class="controls-line">
          <label>
            æ¨¡å¼ï¼ˆMode / æ¨¡å¼ï¼‰ï¼š
            <select id="modeSelect">
              <option value="number">æ•¸å­— Numbers</option>
              <option value="english">è‹±æ–‡å­—æ¯ Letters</option>
              <option value="color">é¡è‰² Colors</option>
              <option value="animal">å‹•ç‰© Animals</option>
            </select>
          </label>
        </div>
        <div class="controls-line">
          <label>
            æ–¹æ ¼ï¼ˆGrid / æ–¹æ ¼ï¼‰ï¼š
            <select id="gridSize">
              <option value="3">3 Ã— 3ï¼ˆæ¨è–¦ï¼‰</option>
              <option value="4">4 Ã— 4</option>
            </select>
          </label>
        </div>
      </div>

      <div class="status-right">
        <div class="status-line">
          <span class="status-label">ç”¨æ™‚ Time / èŠ±è²»æ™‚é–“ï¼š</span>
          <span class="status-value" id="timer">0.00s</span>
        </div>
        <div class="status-line">
          <span class="status-label">æœ€å¥½ Best / æœ€ä½³ç´€éŒ„ï¼š</span>
          <span class="status-value" id="bestTime">â€”</span>
        </div>
      </div>
    </div>

    <div class="target-box">
      <div class="target-text">
        ğŸ¯ è«‹æ‰¾é€™å€‹ï¼ˆFind this / è«‹æ‰¾ä¸‹é¢çš„ç›®æ¨™ï¼‰ï¼š<br />
        <small>ä¾ç…§é †åºä¸€å€‹ä¸€å€‹æŒ‰ï¼šæ•¸å­— / å­—æ¯ / é¡è‰² / å‹•ç‰©ã€‚</small>
      </div>
      <div class="target-main">
        <div class="target-number" id="targetMain">â€”</div>
        <div class="target-sub" id="targetSub"></div>
      </div>
    </div>

    <button id="startBtn" style="width: 100%; margin-bottom: 10px;">
      ğŸš€ é–‹å§‹éŠæˆ² Start / é–‹å§‹
    </button>

    <div class="grid-wrapper">
      <div class="grid" id="grid"></div>
    </div>

    <div class="message" id="message">
      é¸å¥½æ¨¡å¼èˆ‡æ–¹æ ¼ä¹‹å¾Œï¼ŒæŒ‰ã€Œé–‹å§‹éŠæˆ²ã€ï¼Œå¾ <strong>ç¬¬ä¸€å€‹</strong>é–‹å§‹æ‰¾ã€‚<br />
      Choose mode, press Start, then find items in order / ä¾åºæ‰¾ç›®æ¨™ã€‚
    </div>
  </div>

  <script>
    const gridSizeSelect = document.getElementById("gridSize");
    const modeSelect = document.getElementById("modeSelect");
    const startBtn = document.getElementById("startBtn");
    const gridEl = document.getElementById("grid");
    const timerEl = document.getElementById("timer");
    const bestTimeEl = document.getElementById("bestTime");
    const messageEl = document.getElementById("message");
    const targetMainEl = document.getElementById("targetMain");
    const targetSubEl = document.getElementById("targetSub");

    let startTime = null;
    let timerInterval = null;
    let isRunning = false;

    let sequence = [];    // è¦æŒ‰çš„é †åºï¼ˆid é™£åˆ—ï¼‰
    let currentIndex = 0; // ç¾åœ¨è¦æ‰¾ sequence[currentIndex]
    let gridItems = [];   // ç›®å‰é€™ä¸€å±€ç”¨åˆ°çš„ item è³‡æ–™

    const bestTimes = {}; // key: mode+size, value: ç§’æ•¸

    // ====== è³‡æ–™å®šç¾©ï¼šæ•¸å­— / è‹±æ–‡ / é¡è‰² / å‹•ç‰© ======

    function getNumberItems() {
      const arr = [];
      for (let i = 1; i <= 25; i++) {
        arr.push({
          id: String(i),
          main: String(i),
          sub: "",
          type: "number"
        });
      }
      return arr;
    }

    function getEnglishItems() {
      const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
      return letters.map(function (ch) {
        return {
          id: ch,
          main: ch,
          sub: "Letter / è‹±æ–‡å­—æ¯",
          type: "english"
        };
      });
    }

    function getColorItems() {
      const defs = [
        { id: "RED",   en: "Red",    zh: "ç´…è‰²",    bg: "#fecaca", fg: "#7f1d1d" },
        { id: "ORANGE",en: "Orange", zh: "æ©˜è‰²",    bg: "#fed7aa", fg: "#7c2d12" },
        { id: "YELLOW",en: "Yellow", zh: "é»ƒè‰²",    bg: "#fef08a", fg: "#713f12" },
        { id: "GREEN", en: "Green",  zh: "ç¶ è‰²",    bg: "#bbf7d0", fg: "#14532d" },
        { id: "BLUE",  en: "Blue",   zh: "è—è‰²",    bg: "#bfdbfe", fg: "#1d4ed8" },
        { id: "PURPLE",en: "Purple", zh: "ç´«è‰²",    bg: "#e9d5ff", fg: "#581c87" },
        { id: "PINK",  en: "Pink",   zh: "ç²‰ç´…",    bg: "#fed7e2", fg: "#9d174d" },
        { id: "BROWN", en: "Brown",  zh: "å’–å•¡è‰²",  bg: "#fed7aa", fg: "#78350f" },
        { id: "BLACK", en: "Black",  zh: "é»‘è‰²",    bg: "#e5e7eb", fg: "#111827" }
      ];
      return defs.map(function (c) {
        return {
          id: c.id,
          main: c.en,
          sub: c.zh + " / " + c.en,
          bg: c.bg,
          fg: c.fg,
          type: "color"
        };
      });
    }

    function getAnimalItems() {
      const defs = [
        { id: "DOG",  emoji: "ğŸ¶", en: "Dog",   zh: "ç‹—ç‹—" },
        { id: "CAT",  emoji: "ğŸ±", en: "Cat",   zh: "è²“å’ª" },
        { id: "RABBIT",emoji:"ğŸ°", en: "Rabbit",zh: "å…”å…”" },
        { id: "BEAR", emoji: "ğŸ»", en: "Bear",  zh: "ç†Šç†Š" },
        { id: "MONKEY",emoji:"ğŸµ", en: "Monkey",zh: "çŒ´å­" },
        { id: "PANDA",emoji:"ğŸ¼", en: "Panda", zh: "ç†Šè²“" },
        { id: "PIG",  emoji: "ğŸ·", en: "Pig",   zh: "å°è±¬" },
        { id: "CHICK",emoji:"ğŸ¥", en: "Chick", zh: "å°é›" },
        { id: "FROG", emoji: "ğŸ¸", en: "Frog",  zh: "é’è›™" }
      ];
      return defs.map(function (a) {
        return {
          id: a.id,
          main: a.emoji,
          sub: a.zh + " / " + a.en,
          type: "animal"
        };
      });
    }

    function getAllItemsByMode(mode) {
      if (mode === "number") return getNumberItems();
      if (mode === "english") return getEnglishItems();
      if (mode === "color") return getColorItems();
      if (mode === "animal") return getAnimalItems();
      return getNumberItems();
    }

    // ====== å·¥å…·ï¼šæ´—ç‰Œ ======
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        const tmp = array[i];
        array[i] = array[j];
        array[j] = tmp;
      }
      return array;
    }

    // ====== ç”Ÿæˆæ–¹æ ¼ ======
    function generateGrid(size, mode) {
      gridEl.innerHTML = "";
      gridEl.style.gridTemplateColumns = "repeat(" + size + ", 1fr)";

      const total = size * size;
      const allItems = getAllItemsByMode(mode);
      const usable = allItems.slice(0, total); // åªå–å‰ N å€‹
      gridItems = usable.slice();              // è¤‡è£½ä¸€ä»½çµ¦å…¨åŸŸç”¨

      // æŒ‰ã€ŒåŸå§‹é †åºã€ä½œç‚ºæ­£ç¢ºé †åº
      sequence = usable.map(function (item) {
        return item.id;
      });
      currentIndex = 0;
      updateTargetDisplay();

      const shuffled = shuffle(usable.slice());

      shuffled.forEach(function (item) {
        const btn = document.createElement("button");
        btn.className = "cell";
        btn.setAttribute("data-id", item.id);

        // ä¸åŒæ¨¡å¼å±•ç¤ºç•¥æœ‰å·®ç•°
        const mainSpan = document.createElement("span");
        mainSpan.className = "cell-label";
        mainSpan.textContent = item.main;

        const subSpan = document.createElement("span");
        subSpan.className = "cell-sub";
        subSpan.textContent = item.sub || "";

        btn.appendChild(mainSpan);
        if (item.sub) {
          btn.appendChild(subSpan);
        }

        if (item.type === "color") {
          btn.style.backgroundColor = item.bg;
          btn.style.color = item.fg;
        }

        btn.addEventListener("click", onCellClick);
        gridEl.appendChild(btn);
      });
    }

    function updateTargetDisplay() {
      if (!sequence.length || currentIndex >= sequence.length) {
        targetMainEl.textContent = "â€”";
        targetSubEl.textContent = "";
        return;
      }
      const currentId = sequence[currentIndex];
      const item = gridItems.find(function (it) {
        return it.id === currentId;
      });
      if (!item) {
        targetMainEl.textContent = "â€”";
        targetSubEl.textContent = "";
        return;
      }
      targetMainEl.textContent = item.main;
      targetSubEl.textContent = item.sub || "";
    }

    // ====== éŠæˆ²æµç¨‹ ======
    function startGame() {
      const size = parseInt(gridSizeSelect.value, 10);
      const mode = modeSelect.value;

      isRunning = true;
      startBtn.disabled = true;

      messageEl.innerHTML =
        "éŠæˆ²é–‹å§‹å›‰ï¼è«‹ä¾åºæŒ‰æ­£ç¢ºçš„æ ¼å­ã€‚<br/>Game start! Tap items in order / ä¾ç…§é †åºæŒ‰ã€‚";

      timerEl.textContent = "0.00s";

      generateGrid(size, mode);
      updateTargetDisplay();

      if (timerInterval) {
        clearInterval(timerInterval);
      }
      startTime = Date.now();
      timerInterval = setInterval(updateTimer, 60);

      const key = getBestKey();
      if (bestTimes[key] != null) {
        bestTimeEl.textContent = bestTimes[key].toFixed(2) + "s";
      } else {
        bestTimeEl.textContent = "â€”";
      }
    }

    function updateTimer() {
      if (!isRunning || !startTime) return;
      const elapsed = (Date.now() - startTime) / 1000;
      timerEl.textContent = elapsed.toFixed(2) + "s";
    }

    function finishGame() {
      isRunning = false;
      startBtn.disabled = false;
      clearInterval(timerInterval);
      timerInterval = null;

      const finalTime = (Date.now() - startTime) / 1000;
      timerEl.textContent = finalTime.toFixed(2) + "s";

      const key = getBestKey();
      if (bestTimes[key] == null || finalTime < bestTimes[key]) {
        bestTimes[key] = finalTime;
        bestTimeEl.textContent = finalTime.toFixed(2) + "s";
        messageEl.innerHTML =
          "å¤ªæ£’äº†ï¼ğŸ¥³ ä½ æ‰“ç ´è‡ªå·±çš„æœ€ä½³ç´€éŒ„ï¼<br/>Great! New best time / æ–°çš„æœ€å¥½æˆç¸¾ï¼";
      } else {
        messageEl.innerHTML =
          "å®Œæˆï¼ğŸ‘ å¯ä»¥å†ç©ä¸€æ¬¡ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ›´å¿«ï½<br/>Completed! Try again / å†æŒ‘æˆ°çœ‹çœ‹ã€‚";
      }

      targetMainEl.textContent = "â€”";
      targetSubEl.textContent = "";
    }

    function onCellClick(e) {
      if (!isRunning) return;

      const btn = e.currentTarget;
      const id = btn.getAttribute("data-id");
      const expectedId = sequence[currentIndex];

      if (id === expectedId) {
        btn.classList.add("hit");
        btn.disabled = true;
        currentIndex += 1;
        if (currentIndex >= sequence.length) {
          updateTargetDisplay();
          finishGame();
        } else {
          updateTargetDisplay();
        }
      } else {
        btn.classList.add("wrong");
        const currentItem = gridItems.find(function (it) {
          return it.id === expectedId;
        });
        let hint = "";
        if (currentItem) {
          hint =
            currentItem.sub
              ? currentItem.sub
              : currentItem.main;
        }

        messageEl.innerHTML =
          "é€™å€‹ä¸æ˜¯ç¾åœ¨è¦æ‰¾çš„å–”ï½è«‹æ‰¾ <strong>" +
          hint +
          "</strong>ã€‚<br/>Not this one. Find the highlighted target / è«‹æ‰¾ä¸Šé¢é¡¯ç¤ºçš„ç›®æ¨™ã€‚";

        setTimeout(function () {
          btn.classList.remove("wrong");
        }, 180);
      }
    }

    function getBestKey() {
      const size = parseInt(gridSizeSelect.value, 10);
      const mode = modeSelect.value;
      return mode + "_" + size;
    }

    // åˆå§‹åŒ–é¡¯ç¤ºï¼ˆå…ˆé¡¯ç¤ºç©ºç›¤ï¼Œæ•¸å­—æ¨¡å¼ 3x3ï¼‰
    generateGrid(3, "number");
    isRunning = false;
    startBtn.disabled = false;
    startBtn.addEventListener("click", startGame);
  </script>
</body>
</html>
